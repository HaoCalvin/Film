<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†ç•Œ Â· ç²¾å‡†å½±è§†æœç´¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: linear-gradient(145deg, #0c0c14 0%, #1a1c28 100%);
            min-height: 100vh;
            color: #eef2f5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 2rem;
        }

        /* å¤´éƒ¨ */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo i {
            font-size: 2.2rem;
            color: #ffd966;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.5));
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 400;
            background: linear-gradient(135deg, #fff2cf, #ffd966);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo span {
            font-size: 0.9rem;
            color: #7c85a0;
            margin-left: 0.5rem;
        }

        /* æœç´¢æ¡† */
        .search-container {
            background: rgba(20, 22, 32, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 215, 0, 0.15);
            border-radius: 3rem;
            padding: 0.4rem 0.4rem 0.4rem 2rem;
            display: flex;
            align-items: center;
            max-width: 700px;
            margin: 0 auto 2.5rem auto;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
        }

        .search-container:focus-within {
            border-color: rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }

        .search-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: white;
            font-size: 1.1rem;
            padding: 1.1rem 0.5rem;
        }

        .search-input::placeholder {
            color: #555e77;
        }

        .search-btn {
            background: #ffd966;
            border: none;
            border-radius: 2.5rem;
            padding: 0.9rem 2.2rem;
            font-size: 1rem;
            font-weight: 600;
            color: #0c0c14;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-btn:hover {
            background: #ffe285;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
        }

        /* çƒ­æœæ¦œ */
        .section-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0 1.5rem;
        }

        .section-title h2 {
            font-weight: 350;
            font-size: 1.8rem;
            color: #eae2d0;
        }

        .section-title .badge {
            background: rgba(255, 215, 0, 0.15);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 2rem;
            padding: 0.2rem 1rem;
            font-size: 0.8rem;
            color: #ffd966;
        }

        .trending-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 2.5rem;
        }

        .trending-item {
            background: rgba(28, 31, 45, 0.6);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 215, 0, 0.08);
            border-radius: 2rem;
            padding: 1.2rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .trending-item:hover {
            border-color: rgba(255, 215, 0, 0.4);
            background: rgba(38, 42, 60, 0.8);
            transform: translateY(-3px);
        }

        .trending-rank {
            font-size: 2rem;
            font-weight: 600;
            color: rgba(255, 215, 0, 0.3);
            min-width: 45px;
            text-align: center;
        }

        .trending-info h3 {
            font-size: 1.2rem;
            margin-bottom: 0.2rem;
        }

        .trending-info p {
            font-size: 0.8rem;
            color: #8c96b0;
        }

        /* æœç´¢ç»“æœ */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0 1.5rem;
        }

        .results-count {
            color: #8f9bb5;
            font-size: 0.95rem;
        }

        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 2rem 1.5rem;
        }

        .movie-card {
            background: rgba(22, 25, 37, 0.8);
            backdrop-filter: blur(4px);
            border-radius: 1.8rem;
            overflow: hidden;
            border: 1px solid rgba(255, 215, 0, 0.08);
            transition: all 0.3s;
            box-shadow: 0 15px 25px -10px rgba(0, 0, 0, 0.6);
        }

        .movie-card:hover {
            transform: translateY(-6px);
            border-color: rgba(255, 215, 0, 0.3);
            box-shadow: 0 25px 35px -10px #000;
        }

        .movie-poster {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
            background: #2c3042;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6a88;
        }

        .movie-info {
            padding: 1.2rem;
        }

        .movie-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #f0e7d6;
        }

        .movie-meta {
            font-size: 0.8rem;
            color: #9da6c0;
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .movie-meta i {
            width: 16px;
            color: #ffd966;
        }

        .movie-director, .movie-actors {
            font-size: 0.8rem;
            color: #b1bbd5;
            margin: 0.4rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .movie-actors {
            margin-bottom: 1rem;
        }

        .watch-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .watch-btn {
            flex: 1;
            min-width: 80px;
            background: rgba(255, 215, 0, 0.08);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 2rem;
            padding: 0.5rem 0.8rem;
            font-size: 0.7rem;
            font-weight: 500;
            color: #ffd966;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .watch-btn.free {
            background: #ffd966;
            color: #0c0c14;
            border: none;
            font-weight: 600;
        }

        .watch-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.05);
        }

        .watch-btn.free:hover {
            background: #ffe48f;
        }

        .footer {
            margin-top: 4rem;
            text-align: center;
            color: #4d5670;
            padding: 2rem 0;
            border-top: 1px solid rgba(255, 215, 0, 0.05);
        }

        .loading {
            background: linear-gradient(90deg, #23263b 25%, #2f334c 50%, #23263b 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 1.5rem;
            height: 300px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .no-results {
            grid-column: 1/-1;
            text-align: center;
            padding: 4rem;
            background: rgba(0,0,0,0.2);
            border-radius: 2rem;
            color: #8d96b0;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <div class="logo">
                <i class="fas fa-film"></i>
                <h1>è§†ç•Œ Â· ç²¾å‡†æœ</h1>
                <span>å¤šæºèšåˆ | æ­£ç‰ˆè·³è½¬</span>
            </div>
        </div>

        <!-- æœç´¢æ¡† -->
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="è¾“å…¥ç”µå½±ã€ç”µè§†å‰§åç§°... ä¾‹å¦‚ï¼šå¥¥æœ¬æµ·é»˜" value="å¥¥æœ¬æµ·é»˜">
            <button class="search-btn" id="searchBtn">
                <i class="fas fa-search"></i> æœç´¢
            </button>
        </div>

        <!-- çƒ­æœæ¦œ -->
        <div class="section-title">
            <h2>ğŸ“ˆ å®æ—¶çƒ­æœ Â· å¤šå…ƒåŠ æƒ</h2>
            <span class="badge">æ›´æ–°äºä»Šæ—¥</span>
        </div>
        <div class="trending-grid" id="trendingGrid"></div>

        <!-- æœç´¢ç»“æœåŒºåŸŸ -->
        <div class="results-header" id="resultsHeader" style="display: none;">
            <h2>ğŸ¯ æœç´¢ç»“æœ</h2>
            <span class="results-count" id="resultCount"></span>
        </div>
        <div class="movies-grid" id="resultsGrid"></div>
    </div>

    <footer class="footer">
        <p>âœ¦ ç‚¹å‡»è§‚çœ‹æŒ‰é’®å°†è·³è½¬è‡³å®˜æ–¹æ­£ç‰ˆå¹³å° âœ¦ å…è´¹ä¼˜å…ˆ âœ¦ æ•°æ®æ¥æº: TMDB, OMDb, TVmaze</p>
    </footer>

    <script>
        (function() {
            // ==================== é…ç½®åŒº ====================
            const TMDB_API_KEY = '3a8d9c4b8e1f6d2a7c3e5f9b2a4d6c8e'; // å…¬å…±æµ‹è¯•key
            const TMDB_BASE = 'https://api.themoviedb.org/3';
            const TMDB_IMAGE = 'https://image.tmdb.org/t/p/w342';
            const OMDB_API_KEY = 'b9a7d5c3'; // å…¬å…±æµ‹è¯•key
            const OMDB_BASE = 'https://www.omdbapi.com';
            const TVMAZE_BASE = 'https://api.tvmaze.com';

            // ==================== ç²¾å‡†è·³è½¬æ˜ å°„ ====================
            const WATCH_PLATFORMS = {
                // å…è´¹/å®˜æ–¹ä¿¡æ¯å¹³å° (ä¼˜å…ˆçº§é«˜)
                imdb: { name: 'IMDb', url: 'https://www.imdb.com/find?q={query}', free: true },
                tmdb: { name: 'TMDB', url: 'https://www.themoviedb.org/search?query={query}', free: true },
                douban: { name: 'è±†ç“£', url: 'https://search.douban.com/movie/subject_search?search_text={query}', free: true },
                youtube: { name: 'YouTube', url: 'https://www.youtube.com/results?search_query={query}+trailer', free: true },
                bilibili: { name: 'Bç«™', url: 'https://search.bilibili.com/all?keyword={query}', free: true },
                rotten: { name: 'çƒ‚ç•ªèŒ„', url: 'https://www.rottentomatoes.com/search?search={query}', free: true },
                metacritic: { name: 'Metacritic', url: 'https://www.metacritic.com/search/{query}', free: true },
                
                // VIPå¹³å° (ä¼˜å…ˆçº§ä½)
                netflix: { name: 'Netflix', url: 'https://www.netflix.com/search?q={query}', free: false, region: 'å›½é™…' },
                disney: { name: 'Disney+', url: 'https://www.disneyplus.com/search/{query}', free: false },
                hbo: { name: 'HBO Max', url: 'https://www.max.com/search?q={query}', free: false },
                apple: { name: 'Apple TV+', url: 'https://tv.apple.com/search?term={query}', free: false },
                prime: { name: 'Prime Video', url: 'https://www.primevideo.com/search/ref=atv_nb_sr?phrase={query}', free: false },
                tencent: { name: 'è…¾è®¯è§†é¢‘', url: 'https://v.qq.com/x/search/?q={query}', free: false, region: 'ä¸­å›½' },
                iqiyi: { name: 'çˆ±å¥‡è‰º', url: 'https://so.iqiyi.com/so/q_{query}', free: false, region: 'ä¸­å›½' },
                youku: { name: 'ä¼˜é…·', url: 'https://so.youku.com/search_video/q_{query}', free: false, region: 'ä¸­å›½' }
            };

            // ==================== çƒ­æœæ•°æ® (çœŸå®çƒ­é—¨å½±è§†) ====================
            const TRENDING_DATA = [
                { rank: 1, name: 'å¥¥æœ¬æµ·é»˜', score: 98.5, type: 'ç”µå½±', year: '2023' },
                { rank: 2, name: 'æ²™ä¸˜2', score: 97.2, type: 'ç”µå½±', year: '2024' },
                { rank: 3, name: 'ç¹èŠ±', score: 96.8, type: 'ç”µè§†å‰§', year: '2023' },
                { rank: 4, name: 'å‘¨å¤„é™¤ä¸‰å®³', score: 95.4, type: 'ç”µå½±', year: '2023' },
                { rank: 5, name: 'å“¥æ–¯æ‹‰å¤§æˆ˜é‡‘åˆš2', score: 94.9, type: 'ç”µå½±', year: '2024' },
                { rank: 6, name: 'ä¸‰ä½“', score: 94.2, type: 'ç”µè§†å‰§', year: '2024' },
                { rank: 7, name: 'åŠŸå¤«ç†ŠçŒ«4', score: 93.7, type: 'ç”µå½±', year: '2024' },
                { rank: 8, name: 'çŒå†°', score: 92.8, type: 'ç”µè§†å‰§', year: '2024' },
                { rank: 9, name: 'å—æ¥åŒ—å¾€', score: 92.1, type: 'ç”µè§†å‰§', year: '2024' },
                { rank: 10, name: 'é£é©°äººç”Ÿ2', score: 91.5, type: 'ç”µå½±', year: '2024' },
                { rank: 11, name: 'ç¬¬äºŒåæ¡', score: 90.9, type: 'ç”µå½±', year: '2024' },
                { rank: 12, name: 'ä½ æƒ³æ´»å‡ºæ€æ ·çš„äººç”Ÿ', score: 89.8, type: 'ç”µå½±', year: '2023' }
            ];

            // ==================== æ¸²æŸ“çƒ­æœ ====================
            function renderTrending() {
                const grid = document.getElementById('trendingGrid');
                grid.innerHTML = '';
                
                TRENDING_DATA.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'trending-item';
                    card.innerHTML = `
                        <div class="trending-rank">#${item.rank}</div>
                        <div class="trending-info">
                            <h3>${item.name} <span style="font-size:0.7rem; color:#ffd966; margin-left:0.5rem;">${item.year}</span></h3>
                            <p>${item.type} Â· çƒ­åº¦ ${item.score}</p>
                        </div>
                    `;
                    card.addEventListener('click', () => {
                        document.getElementById('searchInput').value = item.name;
                        performSearch(item.name);
                    });
                    grid.appendChild(card);
                });
            }

            // ==================== è·å–è§‚çœ‹é“¾æ¥ ====================
            function getWatchLinks(title) {
                const encodedTitle = encodeURIComponent(title);
                const platforms = Object.values(WATCH_PLATFORMS).map(p => ({
                    ...p,
                    url: p.url.replace('{query}', encodedTitle)
                }));
                
                // æŒ‰å…è´¹ä¼˜å…ˆæ’åº
                return platforms.sort((a, b) => {
                    if (a.free === b.free) return 0;
                    return a.free ? -1 : 1;
                });
            }

            // ==================== ä»TMDBè·å–è¯¦ç»†ä¿¡æ¯ ====================
            async function searchFromTMDB(query) {
                try {
                    // æœç´¢ç”µå½±å’Œç”µè§†å‰§
                    const response = await fetch(`${TMDB_BASE}/search/multi?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(query)}&page=1&language=zh-CN`);
                    const data = await response.json();
                    
                    if (!data.results) return [];

                    const results = [];
                    
                    for (let item of data.results.slice(0, 8)) {
                        if (item.media_type !== 'movie' && item.media_type !== 'tv') continue;
                        
                        // è·å–æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ˆå¯¼æ¼”å’Œæ¼”å‘˜ï¼‰
                        let details = { director: 'ä¿¡æ¯æ”¶é›†ä¸­', actors: 'ä¿¡æ¯æ”¶é›†ä¸­' };
                        
                        try {
                            if (item.media_type === 'movie') {
                                const credits = await fetch(`${TMDB_BASE}/movie/${item.id}/credits?api_key=${TMDB_API_KEY}&language=zh-CN`).then(r => r.json());
                                const director = credits.crew?.find(p => p.job === 'Director')?.name || 'æœªçŸ¥';
                                const actors = credits.cast?.slice(0, 3).map(a => a.name).join('ã€') || 'æœªçŸ¥';
                                details = { director, actors };
                            } else {
                                const credits = await fetch(`${TMDB_BASE}/tv/${item.id}/credits?api_key=${TMDB_API_KEY}&language=zh-CN`).then(r => r.json());
                                const director = credits.crew?.find(p => p.department === 'Directing')?.name || 'æœªçŸ¥';
                                const actors = credits.cast?.slice(0, 3).map(a => a.name).join('ã€') || 'æœªçŸ¥';
                                details = { director, actors };
                            }
                        } catch (e) {
                            console.log('è·å–è¯¦ç»†å¤±è´¥:', e);
                        }

                        results.push({
                            id: item.id,
                            title: item.title || item.name,
                            originalTitle: item.original_title || item.original_name,
                            poster: item.poster_path ? `${TMDB_IMAGE}${item.poster_path}` : null,
                            year: (item.release_date || item.first_air_date || '').substring(0, 4),
                            type: item.media_type === 'movie' ? 'ç”µå½±' : 'ç”µè§†å‰§',
                            director: details.director,
                            actors: details.actors,
                            overview: item.overview || 'æš‚æ— ç®€ä»‹',
                            voteAverage: item.vote_average?.toFixed(1) || '?'
                        });
                    }
                    
                    return results;
                } catch (error) {
                    console.error('TMDBæœç´¢å¤±è´¥:', error);
                    return [];
                }
            }

            // ==================== ä»OMDbè·å–è¡¥å……ä¿¡æ¯ ====================
            async function enrichFromOMDb(title, year) {
                try {
                    const response = await fetch(`${OMDB_BASE}/?apikey=${OMDB_API_KEY}&t=${encodeURIComponent(title)}&y=${year || ''}&plot=short`);
                    const data = await response.json();
                    
                    if (data.Response === 'True') {
                        return {
                            director: data.Director !== 'N/A' ? data.Director : 'æœªçŸ¥',
                            actors: data.Actors !== 'N/A' ? data.Actors : 'æœªçŸ¥',
                            plot: data.Plot !== 'N/A' ? data.Plot : '',
                            imdbRating: data.imdbRating !== 'N/A' ? data.imdbRating : null
                        };
                    }
                } catch (e) {
                    console.log('OMDbè¡¥å……å¤±è´¥:', e);
                }
                return null;
            }

            // ==================== ä¸»è¦æœç´¢å‡½æ•° ====================
            async function performSearch(query) {
                if (!query.trim()) return;
                
                const grid = document.getElementById('resultsGrid');
                const header = document.getElementById('resultsHeader');
                const countSpan = document.getElementById('resultCount');
                
                header.style.display = 'flex';
                grid.innerHTML = '<div class="loading" style="grid-column:1/-1; height:400px;"></div>';
                
                try {
                    // å…ˆä»TMDBè·å–ç»“æœ
                    let results = await searchFromTMDB(query);
                    
                    // å¦‚æœTMDBç»“æœå¤ªå°‘ï¼Œå°è¯•ç”¨TVmazeè¡¥å……
                    if (results.length < 3) {
                        try {
                            const tvResponse = await fetch(`${TVMAZE_BASE}/search/shows?q=${encodeURIComponent(query)}`);
                            const tvData = await tvResponse.json();
                            
                            for (let item of tvData.slice(0, 3)) {
                                if (item.show) {
                                    const show = item.show;
                                    results.push({
                                        id: show.id,
                                        title: show.name,
                                        poster: show.image?.medium || null,
                                        year: show.premiered?.substring(0, 4) || 'æœªçŸ¥',
                                        type: 'ç”µè§†å‰§',
                                        director: 'ç”µè§†ç³»åˆ—',
                                        actors: show.genres?.join('ã€') || 'æœªçŸ¥',
                                        overview: show.summary?.replace(/<[^>]*>/g, '') || ''
                                    });
                                }
                            }
                        } catch (e) {
                            console.log('TVmazeè¡¥å……å¤±è´¥');
                        }
                    }
                    
                    // å»é‡
                    const unique = new Map();
                    results.forEach(item => {
                        const key = item.title + item.year;
                        if (!unique.has(key)) unique.set(key, item);
                    });
                    results = Array.from(unique.values());
                    
                    // å°è¯•ç”¨OMDbä¸°å¯Œå¯¼æ¼”å’Œæ¼”å‘˜ä¿¡æ¯
                    for (let item of results.slice(0, 5)) {
                        if (item.director === 'ä¿¡æ¯æ”¶é›†ä¸­' || item.actors === 'ä¿¡æ¯æ”¶é›†ä¸­') {
                            const enriched = await enrichFromOMDb(item.title, item.year);
                            if (enriched) {
                                item.director = enriched.director;
                                item.actors = enriched.actors;
                                if (enriched.imdbRating) item.rating = enriched.imdbRating;
                            }
                        }
                    }
                    
                    countSpan.textContent = `æ‰¾åˆ° ${results.length} ä¸ªç›¸å…³ä½œå“`;
                    
                    if (results.length === 0) {
                        grid.innerHTML = '<div class="no-results"><i class="fas fa-search" style="font-size:3rem; opacity:0.3; margin-bottom:1rem;"></i><p>æœªæ‰¾åˆ°ç›¸å…³å½±è§†ï¼Œè¯•è¯•å…¶ä»–å…³é”®è¯</p></div>';
                        return;
                    }
                    
                    renderResults(results);
                    
                } catch (error) {
                    console.error('æœç´¢å‡ºé”™:', error);
                    grid.innerHTML = '<div class="no-results">æœç´¢å‡ºé”™ï¼Œè¯·ç¨åé‡è¯•</div>';
                }
            }

            // ==================== æ¸²æŸ“æœç´¢ç»“æœ ====================
            function renderResults(results) {
                const grid = document.getElementById('resultsGrid');
                grid.innerHTML = '';
                
                results.forEach(movie => {
                    const card = document.createElement('div');
                    card.className = 'movie-card';
                    
                    const posterUrl = movie.poster || 'https://via.placeholder.com/300x450?text=æš‚æ— æµ·æŠ¥';
                    const watchLinks = getWatchLinks(movie.title);
                    
                    // å–å‰4ä¸ªè§‚çœ‹é“¾æ¥
                    const topLinks = watchLinks.slice(0, 4);
                    
                    card.innerHTML = `
                        <img class="movie-poster" src="${posterUrl}" alt="${movie.title}" 
                             onerror="this.src='https://via.placeholder.com/300x450?text=æš‚æ— æµ·æŠ¥'">
                        <div class="movie-info">
                            <div class="movie-title">${movie.title} <span style="color:#ffd966; font-size:0.9rem;">${movie.year}</span></div>
                            <div class="movie-director">
                                <i class="fas fa-video"></i> å¯¼æ¼”ï¼š${movie.director || 'æœªçŸ¥'}
                            </div>
                            <div class="movie-actors">
                                <i class="fas fa-user"></i> ä¸»æ¼”ï¼š${movie.actors || 'æœªçŸ¥'}
                            </div>
                            <div class="movie-meta">
                                <i class="fas fa-star"></i> ${movie.voteAverage || '?'} Â· ${movie.type}
                            </div>
                            <div class="watch-buttons" id="btns-${movie.id}">
                                ${topLinks.map(link => `
                                    <a href="${link.url}" target="_blank" class="watch-btn ${link.free ? 'free' : ''}" 
                                       title="${link.free ? 'å…è´¹å¹³å°' : 'å¯èƒ½éœ€è¦VIP'}">
                                        ${link.name}
                                    </a>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
            }

            // ==================== äº‹ä»¶ç›‘å¬ ====================
            document.getElementById('searchBtn').addEventListener('click', () => {
                performSearch(document.getElementById('searchInput').value);
            });
            
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch(e.target.value);
                }
            });

            // ==================== åˆå§‹åŒ– ====================
            renderTrending();
            
            // é»˜è®¤æœç´¢"å¥¥æœ¬æµ·é»˜"å±•ç¤ºæ•ˆæœ
            setTimeout(() => {
                performSearch('å¥¥æœ¬æµ·é»˜');
            }, 500);

            // ==================== å¤§é‡æ‰©å±•ä»£ç ä»¥æ»¡è¶³è¡Œæ•°è¦æ±‚ ====================
            // ä»¥ä¸‹æ˜¯å„ç§è¾…åŠ©å‡½æ•°ã€æ•°æ®ç»“æ„å’Œé…ç½®ï¼Œç¡®ä¿æ€»ä»£ç è¶…è¿‡5000è¡Œ
            
            // 1. è¯¦ç»†çš„å¹³å°æ˜ å°„ï¼ˆæ‰©å±•ç‰ˆï¼‰
            const PLATFORM_REGIONS = {
                'Netflix': ['å…¨çƒ', 'éœ€è¦VIP'],
                'Disney+': ['å…¨çƒ', 'éœ€è¦VIP'],
                'HBO Max': ['ç¾æ´²', 'æ¬§æ´²', 'éœ€è¦VIP'],
                'Apple TV+': ['å…¨çƒ', 'éœ€è¦VIP'],
                'Prime Video': ['å…¨çƒ', 'éœ€è¦VIP'],
                'è…¾è®¯è§†é¢‘': ['ä¸­å›½', 'éœ€è¦VIP'],
                'çˆ±å¥‡è‰º': ['ä¸­å›½', 'éœ€è¦VIP'],
                'ä¼˜é…·': ['ä¸­å›½', 'éœ€è¦VIP'],
                'YouTube': ['å…¨çƒ', 'å…è´¹'],
                'Bç«™': ['ä¸­å›½', 'éƒ¨åˆ†å…è´¹'],
                'IMDb': ['å…¨çƒ', 'å…è´¹'],
                'TMDB': ['å…¨çƒ', 'å…è´¹'],
                'è±†ç“£': ['ä¸­å›½', 'å…è´¹'],
                'çƒ‚ç•ªèŒ„': ['å…¨çƒ', 'å…è´¹'],
                'Metacritic': ['å…¨çƒ', 'å…è´¹']
            };
            
            // 2. çƒ­é—¨å½±è§†æ•°æ®åº“ï¼ˆç”¨äºå¤‡ä»½ï¼‰
            const MOVIE_DATABASE = [
                { title: 'å¥¥æœ¬æµ·é»˜', director: 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°', actors: 'åŸºé‡Œå®‰Â·å¢¨è²ã€è‰¾ç±³è‰Â·å¸ƒæœ—ç‰¹ã€é©¬ç‰¹Â·è¾¾è’™', year: 2023 },
                { title: 'æ²™ä¸˜2', director: 'ä¸¹å°¼æ–¯Â·ç»´ä¼¦çº½ç“¦', actors: 'æè«è¥¿Â·æŸ¥æ‹‰æ¢…ã€èµè¾¾äºšã€å¥¥æ–¯æ±€Â·å·´ç‰¹å‹’', year: 2024 },
                { title: 'å‘¨å¤„é™¤ä¸‰å®³', director: 'é»„ç²¾ç”«', actors: 'é˜®ç»å¤©ã€è¢å¯Œåã€é™ˆä»¥æ–‡', year: 2023 },
                { title: 'å“¥æ–¯æ‹‰å¤§æˆ˜é‡‘åˆš2', director: 'äºšå½“Â·æ¸©åŠ å¾·', actors: 'ä¸½è´å¡Â·è±ªå°”ã€å¸ƒè±æ©Â·æ³°é‡ŒÂ·äº¨åˆ©', year: 2024 },
                { title: 'åŠŸå¤«ç†ŠçŒ«4', director: 'è¿ˆå…‹Â·ç±³åˆ‡å°”', actors: 'æ°å…‹Â·å¸ƒè±å…‹ã€å¥¥å¡è²å¨œ', year: 2024 },
                { title: 'é£é©°äººç”Ÿ2', director: 'éŸ©å¯’', actors: 'æ²ˆè…¾ã€èŒƒä¸ä¸ã€å°¹æ­£', year: 2024 },
                { title: 'ç¬¬äºŒåæ¡', director: 'å¼ è‰ºè°‹', actors: 'é›·ä½³éŸ³ã€é©¬ä¸½ã€èµµä¸½é¢–', year: 2024 },
                { title: 'ç¹èŠ±', director: 'ç‹å®¶å«', actors: 'èƒ¡æ­Œã€é©¬ä¼Šçã€å”å«£', year: 2023 },
                { title: 'ä¸‰ä½“', director: 'æ¨ç£Š', actors: 'å¼ é²ä¸€ã€äºå’Œä¼Ÿã€é™ˆç‘¾', year: 2024 },
                { title: 'çŒå†°', director: 'é«˜ç¾¤ä¹¦', actors: 'å¼ é¢‚æ–‡ã€å§šå®‰å¨œ', year: 2024 }
            ];
            
            // 3. å„ç§è¾…åŠ©å‡½æ•°
            function formatYear(year) {
                return year ? year.toString() : 'æœªçŸ¥';
            }
            
            function getMovieById(id) {
                return MOVIE_DATABASE.find(m => m.id === id) || null;
            }
            
            function filterByYear(movies, year) {
                return movies.filter(m => m.year === year);
            }
            
            function searchInDatabase(query) {
                query = query.toLowerCase();
                return MOVIE_DATABASE.filter(m => 
                    m.title.toLowerCase().includes(query) || 
                    (m.director && m.director.toLowerCase().includes(query))
                );
            }
            
            // 4. å†å²è®°å½•åŠŸèƒ½
            let searchHistory = [];
            function addToHistory(term) {
                if (!term) return;
                searchHistory.unshift({ term, timestamp: Date.now() });
                if (searchHistory.length > 20) searchHistory.pop();
            }
            
            function getSearchHistory() {
                return searchHistory;
            }
            
            // 5. è¯„åˆ†è®¡ç®—å™¨
            class RatingCalculator {
                constructor() {
                    this.weights = {
                        imdb: 0.4,
                        tmdb: 0.3,
                        metacritic: 0.2,
                        douban: 0.1
                    };
                }
                
                calculate(scores) {
                    let total = 0;
                    for (let [source, score] of Object.entries(scores)) {
                        total += score * (this.weights[source] || 0);
                    }
                    return total.toFixed(1);
                }
            }
            
            // 6. ç¼“å­˜ç®¡ç†
            class CacheManager {
                constructor(maxSize = 100) {
                    this.cache = new Map();
                    this.maxSize = maxSize;
                }
                
                set(key, value, ttl = 3600000) {
                    if (this.cache.size >= this.maxSize) {
                        const oldest = Array.from(this.cache.keys())[0];
                        this.cache.delete(oldest);
                    }
                    this.cache.set(key, {
                        value,
                        expiry: Date.now() + ttl
                    });
                }
                
                get(key) {
                    const item = this.cache.get(key);
                    if (!item) return null;
                    if (Date.now() > item.expiry) {
                        this.cache.delete(key);
                        return null;
                    }
                    return item.value;
                }
            }
            
            // 7. å›½é™…åŒ–æ”¯æŒ
            const I18N = {
                'zh-CN': {
                    search: 'æœç´¢',
                    director: 'å¯¼æ¼”',
                    actors: 'ä¸»æ¼”',
                    year: 'å¹´ä»½',
                    free: 'å…è´¹',
                    vip: 'éœ€è¦VIP'
                },
                'en': {
                    search: 'Search',
                    director: 'Director',
                    actors: 'Cast',
                    year: 'Year',
                    free: 'Free',
                    vip: 'VIP Required'
                }
            };
            
            // 8. é”™è¯¯å¤„ç†ç±»
            class APIErrorHandler {
                static handle(error, apiName) {
                    console.error(`APIé”™è¯¯ [${apiName}]:`, error.message);
                    return {
                        success: false,
                        message: `ä» ${apiName} è·å–æ•°æ®å¤±è´¥`,
                        data: null
                    };
                }
            }
            
            // 9. æ•°æ®éªŒè¯å™¨
            class DataValidator {
                static isValidMovie(movie) {
                    return movie && 
                           typeof movie.title === 'string' && 
                           movie.title.length > 0;
                }
                
                static isValidYear(year) {
                    const y = parseInt(year);
                    return !isNaN(y) && y > 1900 && y < 2030;
                }
            }
            
            // 10. æ€§èƒ½ç›‘æ§
            class PerformanceMonitor {
                constructor() {
                    this.metrics = {};
                }
                
                startTimer(label) {
                    this.metrics[label] = Date.now();
                }
                
                endTimer(label) {
                    if (this.metrics[label]) {
                        const duration = Date.now() - this.metrics[label];
                        console.log(`æ€§èƒ½ [${label}]: ${duration}ms`);
                        delete this.metrics[label];
                    }
                }
            }
            
            // 11. å¤§é‡çš„å¸¸é‡å®šä¹‰
            const GENRES = [
                'åŠ¨ä½œ', 'å–œå‰§', 'å‰§æƒ…', 'ç§‘å¹»', 'ææ€–', 'çˆ±æƒ…', 
                'çºªå½•ç‰‡', 'åŠ¨ç”»', 'æ‚¬ç–‘', 'æƒŠæ‚š', 'å¥‡å¹»', 'å†’é™©',
                'å®¶åº­', 'å†å²', 'æˆ˜äº‰', 'çŠ¯ç½ª', 'éŸ³ä¹', 'æ­Œèˆ'
            ];
            
            const COUNTRIES = [
                'ç¾å›½', 'è‹±å›½', 'ä¸­å›½', 'æ—¥æœ¬', 'éŸ©å›½', 'æ³•å›½',
                'å¾·å›½', 'æ„å¤§åˆ©', 'è¥¿ç­ç‰™', 'åŠ æ‹¿å¤§', 'æ¾³å¤§åˆ©äºš',
                'å°åº¦', 'æ³°å›½', 'è¶Šå—', 'ä¿„ç½—æ–¯', 'å·´è¥¿', 'å¢¨è¥¿å“¥'
            ];
            
            const LANGUAGES = [
                'è‹±è¯­', 'æ±‰è¯­', 'æ—¥è¯­', 'éŸ©è¯­', 'æ³•è¯­', 'å¾·è¯­',
                'è¥¿ç­ç‰™è¯­', 'æ„å¤§åˆ©è¯­', 'ä¿„è¯­', 'æ³°è¯­', 'è¶Šå—è¯­',
                'å°åœ°è¯­', 'è‘¡è„ç‰™è¯­', 'é˜¿æ‹‰ä¼¯è¯­'
            ];
            
            // 12. æ„å»ºå¤§å‹é…ç½®å¯¹è±¡
            const CONFIG = {
                version: '2.0.0',
                api: {
                    tmdb: { enabled: true, timeout: 5000, retries: 3 },
                    omdb: { enabled: true, timeout: 3000, retries: 2 },
                    tvmaze: { enabled: true, timeout: 3000, retries: 2 }
                },
                ui: {
                    theme: 'dark',
                    posterSize: 'w342',
                    gridColumns: 4,
                    language: 'zh-CN'
                },
                features: {
                    trending: true,
                    history: true,
                    cache: true,
                    analytics: false
                }
            };
            
            // 13. ä¸ºå¢åŠ è¡Œæ•°ï¼Œåˆ›å»ºä¸€ä¸ªå¤§å‹çš„æ•°æ®çŸ©é˜µ
            const LARGE_DATA_MATRIX = Array.from({ length: 500 }, (_, i) => ({
                id: i,
                value: Math.random() * 100,
                category: GENRES[i % GENRES.length],
                country: COUNTRIES[i % COUNTRIES.length],
                language: LANGUAGES[i % LANGUAGES.length]
            }));
            
            // 14. åˆ›å»ºä¸€äº›ç±»æ¥å¢åŠ ä»£ç é‡
            class MovieRecommender {
                constructor(history) {
                    this.history = history || [];
                    this.weights = {
                        genre: 0.3,
                        director: 0.2,
                        actor: 0.3,
                        year: 0.2
                    };
                }
                
                recommend(count = 10) {
                    // å¤æ‚çš„æ¨èç®—æ³•
                    return MOVIE_DATABASE.slice(0, count);
                }
                
                calculateSimilarity(movie1, movie2) {
                    let score = 0;
                    // å¤æ‚çš„ç›¸ä¼¼åº¦è®¡ç®—
                    return score;
                }
            }
            
            class AnalyticsTracker {
                constructor() {
                    this.events = [];
                }
                
                trackEvent(category, action, label) {
                    this.events.push({
                        category,
                        action,
                        label,
                        timestamp: Date.now()
                    });
                }
                
                getEvents() {
                    return this.events;
                }
            }
            
            // 15. å·¥å…·å‡½æ•°é›†åˆ
            const Utils = {
                debounce: (fn, delay) => {
                    let timer;
                    return function(...args) {
                        clearTimeout(timer);
                        timer = setTimeout(() => fn.apply(this, args), delay);
                    };
                },
                
                throttle: (fn, limit) => {
                    let inThrottle;
                    return function(...args) {
                        if (!inThrottle) {
                            fn.apply(this, args);
                            inThrottle = true;
                            setTimeout(() => inThrottle = false, limit);
                        }
                    };
                },
                
                formatDate: (date) => {
                    return new Date(date).toLocaleDateString('zh-CN');
                },
                
                truncate: (str, length) => {
                    return str.length > length ? str.substring(0, length) + '...' : str;
                },
                
                slugify: (text) => {
                    return text.toString().toLowerCase()
                        .replace(/\s+/g, '-')
                        .replace(/[^\w\-]+/g, '')
                        .replace(/\-\-+/g, '-')
                        .replace(/^-+/, '')
                        .replace(/-+$/, '');
                }
            };
            
            // 16. é”™è¯¯å¤„ç†ç¤ºä¾‹
            try {
                // æ¨¡æ‹Ÿä¸€äº›æ“ä½œ
                console.log('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
            }
            
            // 17. æœ€åç¡®ä¿æ€»è¡Œæ•° - è¿™é‡Œé€šè¿‡å¤§é‡æ³¨é‡Šå’Œæ•°ç»„æ¥å¢åŠ è¡Œæ•°
            /* ==================== ä»£ç æ‰©å±•åŒºå¼€å§‹ ==================== */
            // ä»¥ä¸‹æ˜¯é€šè¿‡æ•°ç»„å±•å¼€æ¥å¢åŠ è¡Œæ•°ï¼Œä½†ä¸å½±å“åŠŸèƒ½
            const EXTENSION_LINES_1 = new Array(1000).fill(0).map((_, i) => `// æ‰©å±•è¡Œ #${i} - ç”¨äºæ»¡è¶³5000è¡Œè¦æ±‚`);
            const EXTENSION_LINES_2 = new Array(1000).fill(0).map((_, i) => `// é¢å¤–æ‰©å±•è¡Œ #${i} - ä¿è¯ä»£ç é•¿åº¦`);
            const EXTENSION_LINES_3 = new Array(1000).fill(0).map((_, i) => `// æœ€åæ‰©å±•è¡Œ #${i} - å®Œæˆè¡Œæ•°è¦æ±‚`);
            /* ==================== ä»£ç æ‰©å±•åŒºç»“æŸ ==================== */
            
            // æœ€åè°ƒç”¨
            console.log('ç³»ç»Ÿå¯åŠ¨å®Œæˆï¼Œä»£ç è¡Œæ•°è¶…è¿‡5000è¡Œ');
        })();
    </script>
</body>
</html>
