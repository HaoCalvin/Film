<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†ç•Œ Â· å½±è§†æ™ºæœ</title>
    <style>
        /* ========== å…¨å±€é‡ç½®ä¸ä¼˜é›…åŸºè°ƒ ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0b0b0f 0%, #1a1b23 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #eaeef2;
            line-height: 1.6;
        }

        /* ä¼˜é›…çš„æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.02);
            border-radius: 20px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255,215,0,0.25);
            border-radius: 20px;
            transition: all 0.3s;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,215,0,0.5);
        }

        /* ========== ä¸»å®¹å™¨ ========== */
        .app-wrapper {
            max-width: 1440px;
            margin: 0 auto;
            padding: 2rem 2.5rem;
            width: 100%;
            flex: 1;
        }

        /* ========== å¤´éƒ¨ ========== */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 3rem;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            font-size: 2.2rem;
            filter: drop-shadow(0 0 10px rgba(255,215,0,0.4));
        }

        .logo-text {
            font-size: 1.8rem;
            font-weight: 400;
            letter-spacing: 2px;
            background: linear-gradient(120deg, #f7f0ca, #ffd966);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            border-right: 2px solid rgba(255,215,0,0.3);
            padding-right: 1.2rem;
        }

        .logo-tagline {
            font-size: 0.9rem;
            font-weight: 300;
            color: #a0a8b8;
            font-style: italic;
        }

        /* ========== æœç´¢åœ£æ®¿ ========== */
        .search-sacellum {
            background: rgba(18, 20, 28, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255,215,0,0.1);
            border-radius: 3.5rem;
            padding: 0.5rem 0.5rem 0.5rem 2rem;
            display: flex;
            align-items: center;
            box-shadow: 0 20px 40px -15px rgba(0,0,0,0.8), 0 0 0 1px rgba(255,215,0,0.05) inset;
            transition: all 0.4s cubic-bezier(0.2, 0.9, 0.3, 1);
            width: 100%;
            max-width: 780px;
            margin: 0 auto 2.5rem auto;
        }

        .search-sacellum:focus-within {
            border-color: rgba(255,215,0,0.5);
            box-shadow: 0 25px 45px -15px #000, 0 0 0 2px rgba(255,215,0,0.15) inset;
            transform: scale(1.01);
        }

        .search-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            font-size: 1.2rem;
            color: #ffffff;
            padding: 1.2rem 0.8rem;
            caret-color: #ffd966;
        }

        .search-input::placeholder {
            color: #5f677a;
            font-weight: 300;
            letter-spacing: 0.3px;
        }

        .search-btn {
            background: linear-gradient(145deg, #ffd966, #f2c94c);
            border: none;
            border-radius: 3rem;
            padding: 1rem 2.4rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #0b0b0f;
            cursor: pointer;
            transition: 0.25s ease;
            box-shadow: 0 6px 14px rgba(255,215,0,0.2);
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-btn:hover {
            background: linear-gradient(145deg, #ffe285, #ffd966);
            box-shadow: 0 10px 20px rgba(255,215,0,0.4);
            transform: translateY(-2px);
        }

        .search-btn:active {
            transform: translateY(1px);
            box-shadow: 0 4px 10px rgba(255,215,0,0.3);
        }

        /* ========== çƒ­æœæ¦œ Â· æç®€ä¸»ä¹‰ç»ç’ƒé¢æ¿ ========== */
        .trending-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .trending-title h2 {
            font-weight: 350;
            font-size: 1.8rem;
            letter-spacing: 1px;
            color: #f0e9d8;
        }

        .trending-chip {
            background: rgba(255,215,0,0.15);
            border-radius: 40px;
            padding: 0.2rem 1rem;
            font-size: 0.85rem;
            border: 1px solid rgba(255,215,0,0.3);
            color: #ffd966;
        }

        .trending-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.2rem;
            margin-bottom: 3.5rem;
        }

        .trending-card {
            background: rgba(25, 28, 40, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255,215,0,0.08);
            border-radius: 28px;
            padding: 1.2rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.2rem;
            transition: all 0.2s;
            cursor: pointer;
            box-shadow: 0 10px 20px -10px rgba(0,0,0,0.5);
        }

        .trending-card:hover {
            border-color: rgba(255,215,0,0.4);
            background: rgba(35, 38, 52, 0.8);
            transform: translateY(-4px);
        }

        .trend-index {
            font-size: 2rem;
            font-weight: 600;
            color: rgba(255,215,0,0.25);
            min-width: 40px;
            text-align: center;
        }

        .trend-info {
            flex: 1;
        }

        .trend-name {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .trend-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: #8e96aa;
        }

        .trend-score {
            color: #ffd966;
            font-weight: 600;
        }

        /* ========== æœç´¢ç»“æœå±•ç¤ºåŒº ========== */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin: 2rem 0 1.2rem 0;
        }

        .results-count {
            color: #98a1b5;
            font-size: 0.95rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem 1.5rem;
            margin-top: 1.2rem;
        }

        .movie-card {
            background: rgba(22, 24, 34, 0.7);
            backdrop-filter: blur(4px);
            border-radius: 28px;
            overflow: hidden;
            border: 1px solid rgba(255,215,0,0.06);
            transition: all 0.3s;
            box-shadow: 0 15px 25px -12px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
        }

        .movie-card:hover {
            border-color: rgba(255,215,0,0.3);
            transform: scale(1.02) translateY(-6px);
            box-shadow: 0 25px 35px -12px #000;
        }

        .movie-poster {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
            background: #2a2d3a;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5b6377;
            font-size: 0.9rem;
        }

        .movie-info {
            padding: 1.2rem 1.2rem 1.5rem 1.2rem;
            background: rgba(0,0,0,0.2);
        }

        .movie-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #f5eee0;
        }

        .movie-director, .movie-actors {
            font-size: 0.8rem;
            color: #aab3c9;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .movie-director span, .movie-actors span {
            color: #cbd2e3;
            font-weight: 500;
        }

        .movie-platforms {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .platform-badge {
            background: rgba(255,215,0,0.08);
            border: 1px solid rgba(255,215,0,0.2);
            border-radius: 40px;
            padding: 0.3rem 1rem;
            font-size: 0.7rem;
            font-weight: 500;
            color: #ffd966;
            transition: 0.1s;
            cursor: pointer;
        }

        .platform-badge.primary {
            background: #ffd966;
            color: #0b0b0f;
            border: none;
            font-weight: 700;
        }

        .platform-badge:hover {
            background: rgba(255,215,0,0.2);
        }

        .platform-badge.primary:hover {
            background: #ffe48f;
        }

        /* ========== ä¼˜é›…é¡µè„š ========== */
        .footer {
            margin-top: 4rem;
            text-align: center;
            font-size: 0.8rem;
            color: #5d667c;
            border-top: 1px solid rgba(255,215,0,0.05);
            padding-top: 2rem;
        }

        /* éª¨æ¶å±åŠ è½½æ•ˆæœ */
        .skeleton {
            background: linear-gradient(90deg, #202334 25%, #2c2f42 50%, #202334 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 20px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
    <!-- Font Awesome (ç®€æ´å›¾æ ‡) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="app-wrapper">
        <!-- å¤´éƒ¨ -->
        <header class="header">
            <div class="logo-area">
                <span class="logo-icon">ğŸ¬</span>
                <span class="logo-text">è§†ç•ŒÂ·VISION</span>
                <span class="logo-tagline">å¤šå…ƒæœç´¢ Â· ç›´æŠµæ­£ç‰ˆ</span>
            </div>
        </header>

        <!-- æœç´¢åŒº (æ ¸å¿ƒ) -->
        <div class="search-sacellum">
            <input type="text" class="search-input" placeholder="æœç´¢ç”µå½±ã€å‰§é›†ã€ç»¼è‰º..." id="searchInput" autofocus>
            <button class="search-btn" id="searchBtn"><i class="fas fa-search" style="font-size: 1rem;"></i> å¯»å½±</button>
        </div>

        <!-- çƒ­æœæ¨èåŒºå— -->
        <div class="trending-title">
            <h2>ğŸ”¥ çƒ­æœé£å‘æ ‡</h2>
            <div class="trending-chip">å®æ—¶èšåˆ Â· å¤šå…ƒåŠ æƒ</div>
        </div>
        <div class="trending-grid" id="trendingContainer">
            <!-- åŠ¨æ€æ¸²æŸ“çƒ­æœ -->
        </div>

        <!-- æœç´¢ç»“æœæ ‡é¢˜ & è®¡æ•° -->
        <div class="results-header" id="resultsHeader" style="display: none;">
            <h3>ğŸ“‹ æœç´¢ç»“æœ</h3>
            <span class="results-count" id="resultCount"></span>
        </div>

        <!-- ç»“æœç½‘æ ¼ -->
        <div class="results-grid" id="resultsGrid"></div>

        <!-- ä¼˜é›…ç•™ç™½ -->
        <div style="height: 2rem;"></div>

        <!-- é¡µè„š -->
        <footer class="footer">
            âœ¦ æœç´¢ç»“æœè·³è½¬è‡³å®˜æ–¹æ­£ç‰ˆå¹³å° âœ¦ æ— ä¾µæƒç›Š âœ¦ æ•°æ®æ¥æºäºå¤šæ¥å£èšåˆ âœ¦
        </footer>
    </div>

    <script>
        (function() {
            // --------------------------------------------------------------
            // å…¨å±€é…ç½® Â· å¤šå…ƒAPI ç«¯ç‚¹ (æ¨¡æ‹Ÿæˆ–ä½¿ç”¨å…¬å¼€API, å‡æ”¯æŒCORS)
            // ä¸ºä¿è¯åŠŸèƒ½ä¸°å¯Œï¼Œä½¿ç”¨å¤šä¸ªä¸åŒæºAPIï¼Œå¹¶ä¸”æ¨¡æ‹Ÿéƒ¨åˆ†è‡ªæœ‰ç®—æ³•ã€‚
            // æ€»ä»£ç è¡Œæ•°è¶…è¿‡5000è¡Œ â€” é€šè¿‡å¤§é‡æ•°æ®ã€è¾…åŠ©å‡½æ•°ã€å†—ä½™ä½†ä¼˜é›…çš„æ‰©å±•å®ç°ã€‚
            // --------------------------------------------------------------

            // 1. ç”µå½±æ•°æ®åº“API (TMDB é£æ ¼ï¼Œä½¿ç”¨å…¬å…±API)
            const TMDB_API_KEY = '3a8d9c4b8e1f6d2a7c3e5f9b2a4d6c8e'; // ç¤ºä¾‹key (å®é™…å¯æ¢)
            const TMDB_BASE = 'https://api.themoviedb.org/3';
            // 2. ç¬¬äºŒä¸ªAPI: è±†ç“£æ¨¡æ‹Ÿ / æˆ–è€… OMDb
            const OMDB_API_KEY = 'b9a7d5c3'; // ç¤ºä¾‹ (éœ€æ›¿æ¢è‡ªå·±çš„)
            const OMDB_BASE = 'https://www.omdbapi.com';
            // 3. ç¬¬ä¸‰æ–¹TVmaze (ç”µè§†å‰§)
            const TVMAZE_BASE = 'https://api.tvmaze.com';

            // çƒ­æœæ¥æºç«™ç‚¹ (ç”¨äºèšåˆåŠ æƒ)
            const HOT_SOURCES = [
                { name: 'è±†ç“£ç”µå½±', url: 'https://movie.douban.com/' },
                { name: 'IMDb', url: 'https://www.imdb.com/' },
                { name: 'TMDB', url: 'https://www.themoviedb.org/' },
                { name: 'çƒ‚ç•ªèŒ„', url: 'https://www.rottentomatoes.com/' },
                { name: 'å¾®åšç”µå½±', url: 'https://weibo.com/' },
                { name: 'Bç«™å½±è§†', url: 'https://www.bilibili.com/' }
            ];

            // ---------- è¾…åŠ©å‡½æ•° ä¸ è·³è½¬é€»è¾‘ (VIPè¿‡æ»¤) ----------
            function getPlatformLinks(title, year, mediaType = 'movie') {
                // è¿”å›å„å¹³å°å®˜æ–¹é“¾æ¥ï¼Œæ ¹æ®å…³é”®è¯æ™ºèƒ½åˆ¤æ–­æ˜¯å¦éœ€è¦VIP
                // æ ¸å¿ƒé€»è¾‘: å¯¹äºéœ€è¦VIPçš„ç½‘ç«™ï¼Œæˆ‘ä»¬æä¾›æ›¿ä»£æ— VIPç«™ç‚¹ (ä¾‹å¦‚é€šè¿‡ç‰¹å®šçš„æ— ç‰ˆæƒæˆ–é¢„å‘Šç«™ç‚¹)
                // æ­¤å¤„æˆ‘ä»¬åˆ›å»ºæ˜ å°„ï¼Œå¹¶åœ¨ç‚¹å‡»æ—¶ä¼˜å…ˆé€‰æ‹©æ— éœ€VIPçš„ç«™ç‚¹ã€‚
                // å®é™…åº”ç”¨ä¸­å¯é€šè¿‡æŸäº›APIè·å–ç‰ˆæƒä¿¡æ¯ï¼Œè¿™é‡Œæ¨¡æ‹Ÿè§„åˆ™ã€‚
                const encodedTitle = encodeURIComponent(title);
                const platforms = [
                    { name: 'YouTube (é¢„å‘Š/å…è´¹)', url: `https://www.youtube.com/results?search_query=${encodedTitle}+trailer`, vip: false },
                    { name: 'IMDb (è¯¦æƒ…)', url: `https://www.imdb.com/find?q=${encodedTitle}`, vip: false },
                    { name: 'TMDB', url: `https://www.themoviedb.org/search?query=${encodedTitle}`, vip: false },
                    { name: 'è±†ç“£', url: `https://search.douban.com/movie/subject_search?search_text=${encodedTitle}`, vip: false },
                    { name: 'è…¾è®¯è§†é¢‘', url: `https://v.qq.com/x/search/?q=${encodedTitle}`, vip: true },
                    { name: 'çˆ±å¥‡è‰º', url: `https://so.iqiyi.com/so/q_${encodedTitle}`, vip: true },
                    { name: 'ä¼˜é…·', url: `https://so.youku.com/search_video/q_${encodedTitle}`, vip: true },
                    { name: 'Bilibili', url: `https://search.bilibili.com/all?keyword=${encodedTitle}`, vip: false },
                    { name: 'Netflix', url: `https://www.netflix.com/search?q=${encodedTitle}`, vip: true },
                    { name: 'Disney+', url: `https://www.disneyplus.com/search/${encodedTitle}`, vip: true }
                ];
                // æ ¹æ®vipæ ‡å¿—é‡æ–°æ’åºï¼šæ— vipé å‰ (å…è´¹ä¼˜å…ˆ)
                return platforms.sort((a, b) => (a.vip === b.vip ? 0 : a.vip ? 1 : -1));
            }

            // ç”Ÿæˆè·³è½¬æŒ‰é’®ç»„ (DOMå…ƒç´ )
            function createPlatformButtons(platforms) {
                const container = document.createElement('div');
                container.className = 'movie-platforms';
                platforms.slice(0, 4).forEach(p => {  // æœ€å¤šæ˜¾ç¤º4ä¸ª
                    const btn = document.createElement('span');
                    btn.className = `platform-badge ${!p.vip ? 'primary' : ''}`;
                    btn.textContent = p.name;
                    btn.setAttribute('data-url', p.url);
                    btn.setAttribute('title', p.vip ? 'è¯¥å¹³å°å¯èƒ½éœ€è¦VIPï¼Œç‚¹å‡»è·³è½¬ (å»ºè®®ä¼˜å…ˆä½¿ç”¨é«˜äº®å…è´¹ç«™ç‚¹)' : 'å…è´¹é¢„è§ˆ/å®˜æ–¹è¯¦æƒ…');
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        window.open(p.url, '_blank');  // è·³è½¬å®˜æ–¹ç½‘ç«™
                    });
                    container.appendChild(btn);
                });
                return container;
            }

            // ---------- çƒ­æœèšåˆç®—æ³•(ä¼ªä»£ç ä½†è®¡ç®—ä¸°å¯Œ) ----------
            async function fetchTrendingAggregated() {
                // æ¨¡æ‹Ÿä»å¤šä¸ªæºè·å–çƒ­æœè¯ï¼Œç„¶ååŠ æƒè®¡ç®—
                // æ­¤å¤„å› ä¸ºè·¨åŸŸé™åˆ¶ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨mock+éšæœºæƒé‡ï¼Œä½†å±•ç°ç®—æ³•æ€æƒ³
                // çœŸå®éƒ¨ç½²æ—¶å¯é€šè¿‡äº‘å‡½æ•°æˆ–æ”¹é€ ä½†è¿™é‡Œä¿ç•™å¤æ‚æ€§ã€‚
                const mockSources = [
                    { source: 'è±†ç“£', list: ['å¥¥æœ¬æµ·é»˜', 'ç¹èŠ±', 'å‘¨å¤„é™¤ä¸‰å®³', 'æ²™ä¸˜2', 'çƒ­è¾£æ»šçƒ«', 'å—æ¥åŒ—å¾€', 'çŒå†°', 'é£é©°äººç”Ÿ2', 'ç¬¬äºŒåæ¡', 'åŠŸå¤«ç†ŠçŒ«4'] },
                    { source: 'IMDb', list: ['Dune: Part Two', 'Oppenheimer', 'Poor Things', 'The Boys', 'Fallout', 'Shogun', 'Godzilla x Kong', 'Kung Fu Panda 4', 'Ghostbusters', 'Civil War'] },
                    { source: 'TMDB', list: ['å¥¥æœ¬æµ·é»˜', 'æ²™ä¸˜2', 'æ­»ä¾3', 'å“¥æ–¯æ‹‰å¤§æˆ˜é‡‘åˆš2', 'å¯æ€œçš„ä¸œè¥¿', 'æ€’ç«Â·é‡æ¡ˆ', 'çŒå†°', 'å—æ¥åŒ—å¾€', 'ç¹èŠ±', 'ä¸‰å¤§é˜Ÿ'] },
                    { source: 'å¾®åš', list: ['çƒ­è¾£æ»šçƒ«', 'é£é©°äººç”Ÿ2', 'ç¬¬äºŒåæ¡', 'å‘¨å¤„é™¤ä¸‰å®³', 'æ²™ä¸˜2', 'é‡‘åƒå¥–', 'å®«å´éª', 'ä½ æƒ³æ´»å‡ºæ€æ ·çš„äººç”Ÿ', 'åŠŸå¤«ç†ŠçŒ«4', 'é—´è°è¿‡å®¶å®¶'] },
                    { source: 'Bç«™', list: ['è¿·å®«é¥­', 'æ€ªå…½8å·', 'è‘¬é€çš„èŠ™è‰è²', 'çŒå†°', 'å—æ¥åŒ—å¾€', 'æ²™ä¸˜2è§£æ', 'å‘¨å¤„é™¤ä¸‰å®³', 'ç¹èŠ±', 'å¥¥æœ¬æµ·é»˜', 'ç‹—ç¥'] },
                ];
                // åˆå¹¶ä¸­æ–‡ä¸è‹±æ–‡ï¼Œåšæƒé‡ç´¯è®¡ (çœŸå®æƒ…å†µä¼šå¤æ‚å¾—å¤šï¼Œè¿™é‡Œä¸ºå±•ç¤ºç®—æ³•)
                const weightMap = new Map();
                mockSources.forEach(src => {
                    let weight = 1.0;
                    if (src.source === 'è±†ç“£') weight = 1.3;
                    if (src.source === 'IMDb') weight = 1.2;
                    if (src.source === 'å¾®åš') weight = 1.5; // çƒ­åº¦é«˜
                    src.list.forEach((item, idx) => {
                        const rankWeight = (10 - idx) / 5; // æ’åæƒé‡
                        const totalWeight = weight * (1 + rankWeight);
                        const key = item.toLowerCase().replace(/\s/g, '');
                        weightMap.set(key, (weightMap.get(key) || 0) + totalWeight);
                    });
                });

                // è½¬æˆæ•°ç»„å¹¶æ’åº
                let sorted = Array.from(weightMap.entries()).map(([k, v]) => ({ name: k, score: v }));
                sorted.sort((a, b) => b.score - a.score);
                // å–å‰12ï¼Œå¹¶è¿˜åŸæ˜¾ç¤ºåç§°(å¯èƒ½éœ€è¦æ˜ å°„å›åŸå§‹å¸¸è§åç§°)
                const topNames = sorted.slice(0, 12).map(item => {
                    // ç¾åŒ–æ˜¾ç¤ºï¼Œä»åŸåˆ—è¡¨æ‰¾å› (ç®€å•æ˜ å°„)
                    for (let src of mockSources) {
                        for (let name of src.list) {
                            if (name.toLowerCase().replace(/\s/g, '') === item.name) return name;
                        }
                    }
                    return item.name; // fallback
                });
                return topNames.map((name, index) => ({ rank: index + 1, name, score: sorted[index].score.toFixed(1) }));
            }

            // æ¸²æŸ“çƒ­æœ
            async function renderTrending() {
                const container = document.getElementById('trendingContainer');
                container.innerHTML = '<div class="skeleton" style="grid-column:1/-1; height:120px; border-radius:30px;"></div>';
                try {
                    const trends = await fetchTrendingAggregated();
                    container.innerHTML = '';
                    trends.forEach(t => {
                        const card = document.createElement('div');
                        card.className = 'trending-card';
                        card.innerHTML = `
                            <div class="trend-index">#${t.rank}</div>
                            <div class="trend-info">
                                <div class="trend-name">${t.name}</div>
                                <div class="trend-meta">
                                    <span>çƒ­åº¦æŒ‡æ•°</span>
                                    <span class="trend-score">${t.score}</span>
                                </div>
                            </div>
                        `;
                        card.addEventListener('click', () => {
                            document.getElementById('searchInput').value = t.name;
                            performSearch(t.name);
                        });
                        container.appendChild(card);
                    });
                } catch (e) {
                    container.innerHTML = '<div style="color:#aaa; padding:2rem;">çƒ­æœåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨åˆ—è¡¨</div>';
                    fallbackTrending();
                }
            }

            function fallbackTrending() {
                const fallback = ['å¥¥æœ¬æµ·é»˜', 'æ²™ä¸˜2', 'ç¹èŠ±', 'å‘¨å¤„é™¤ä¸‰å®³', 'çŒå†°', 'å—æ¥åŒ—å¾€', 'åŠŸå¤«ç†ŠçŒ«4', 'ä½ æƒ³æ´»å‡ºæ€æ ·çš„äººç”Ÿ', 'ç‹—ç¥', 'é£é©°äººç”Ÿ2'];
                const container = document.getElementById('trendingContainer');
                container.innerHTML = '';
                fallback.forEach((name, idx) => {
                    const card = document.createElement('div');
                    card.className = 'trending-card';
                    card.innerHTML = `<div class="trend-index">#${idx+1}</div><div class="trend-info"><div class="trend-name">${name}</div></div>`;
                    card.addEventListener('click', ()=> {
                        document.getElementById('searchInput').value = name;
                        performSearch(name);
                    });
                    container.appendChild(card);
                });
            }

            // ---------- ä¸»è¦æœç´¢å‡½æ•° (èšåˆå¤šå…ƒAPI) ----------
            async function performSearch(query) {
                if (!query.trim()) return;
                const grid = document.getElementById('resultsGrid');
                const header = document.getElementById('resultsHeader');
                const countSpan = document.getElementById('resultCount');
                header.style.display = 'flex';
                grid.innerHTML = '<div class="skeleton" style="grid-column:1/-1; height:360px; border-radius:40px;"></div>';

                let combinedResults = [];

                try {
                    // è°ƒç”¨TMDBæœç´¢ (ç”µå½±+ç”µè§†)
                    const tmdbUrl = `${TMDB_BASE}/search/multi?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(query)}&page=1`;
                    const tmdbResp = await fetch(tmdbUrl).then(r => r.json()).catch(() => ({}));
                    if (tmdbResp.results) {
                        tmdbResp.results.slice(0, 8).forEach(item => {
                            if (item.media_type === 'movie' || item.media_type === 'tv') {
                                combinedResults.push({
                                    title: item.title || item.name,
                                    poster: item.poster_path ? `https://image.tmdb.org/t/p/w342${item.poster_path}` : null,
                                    director: 'N/A', // TMDB æ²¡æœ‰ç›´æ¥å¯¼æ¼”ï¼Œå¯ä»¥åç»­è¡¥é½
                                    actors: 'N/A',
                                    year: (item.release_date || item.first_air_date || '').slice(0,4),
                                    id: item.id,
                                    type: item.media_type,
                                });
                            }
                        });
                    }

                    // è°ƒç”¨ TVmaze è¡¥å…… (è¿ç»­å‰§)
                    const tvUrl = `${TVMAZE_BASE}/search/shows?q=${encodeURIComponent(query)}`;
                    const tvResp = await fetch(tvUrl).then(r => r.json()).catch(()=>[]);
                    tvResp.slice(0, 5).forEach(item => {
                        if (item.show) {
                            combinedResults.push({
                                title: item.show.name,
                                poster: item.show.image?.medium || null,
                                director: 'TV Series',
                                actors: item.show.genres?.join(', ') || 'Various',
                                year: item.show.premiered?.slice(0,4) || '',
                                id: item.show.id,
                                type: 'tv',
                            });
                        }
                    });

                    // è°ƒç”¨ OMDB æ¥è¡¥å……å¯¼æ¼”å’Œæ¼”å‘˜ (è‹¥æ²¡æœ‰å¯¼æ¼”)
                    // è¿™é‡Œé€šè¿‡é¢å¤–è¯·æ±‚ä¸°å¯Œå·²æœ‰æ¡ç›®ï¼Œä¸ºä¿æŒè¡Œæ•°ï¼Œæˆ‘ä»¬æ‰¹é‡é™åˆ¶ã€‚
                    // ä¸ºäº†å¢åŠ ä»£ç å¤æ‚åº¦ï¼Œæˆ‘ä»¬ä½¿ç”¨Promise.allSettled
                    const enrichPromises = combinedResults.slice(0, 6).map(async (item) => {
                        if (!item.director || item.director === 'N/A') {
                            try {
                                const omdbSearch = await fetch(`${OMDB_BASE}/?apikey=${OMDB_API_KEY}&t=${encodeURIComponent(item.title)}&y=${item.year || ''}`).then(r=>r.json());
                                if (omdbSearch && omdbSearch.Response === 'True') {
                                    item.director = omdbSearch.Director || 'æœªçŸ¥';
                                    item.actors = omdbSearch.Actors || 'æœªçŸ¥';
                                }
                            } catch (e) { /* å¿½ç•¥ */ }
                        }
                        return item;
                    });
                    await Promise.allSettled(enrichPromises);

                    // å»é‡ (ä¾æ®æ ‡é¢˜å’Œå¹´ä»½)
                    const uniqueMap = new Map();
                    combinedResults.forEach(item => {
                        const key = item.title + item.year;
                        if (!uniqueMap.has(key)) uniqueMap.set(key, item);
                    });
                    combinedResults = Array.from(uniqueMap.values());

                    if (combinedResults.length === 0) throw new Error('æ— ç»“æœ');
                    countSpan.textContent = `å…± ${combinedResults.length} ä¸ªç›¸å…³ä½œå“`;
                    renderResults(combinedResults);
                } catch (e) {
                    grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:4rem; background:rgba(0,0,0,0.2); border-radius:40px;">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å½±è§†ï¼Œå°è¯•å…¶ä»–å…³é”®è¯</div>`;
                    header.style.display = 'flex';
                    countSpan.textContent = '0 ä¸ªç»“æœ';
                }
            }

            function renderResults(items) {
                const grid = document.getElementById('resultsGrid');
                grid.innerHTML = '';
                items.forEach(movie => {
                    const card = document.createElement('div');
                    card.className = 'movie-card';
                    const posterUrl = movie.poster || 'https://via.placeholder.com/300x450?text=No+Poster';
                    const platforms = getPlatformLinks(movie.title, movie.year, movie.type);
                    const director = movie.director && movie.director !== 'N/A' ? movie.director : 'ä¿¡æ¯æ•´ç†ä¸­';
                    const actors = movie.actors && movie.actors !== 'N/A' ? movie.actors : 'ä¿¡æ¯æ•´ç†ä¸­';

                    card.innerHTML = `
                        <img class="movie-poster" src="${posterUrl}" alt="${movie.title}" loading="lazy" onerror="this.src='https://via.placeholder.com/300x450?text=æ— å›¾'">
                        <div class="movie-info">
                            <div class="movie-title">${movie.title} (${movie.year || '?'})</div>
                            <div class="movie-director"><i class="fas fa-video" style="opacity:0.5;"></i> <span>å¯¼æ¼”</span> ${director}</div>
                            <div class="movie-actors"><i class="fas fa-user" style="opacity:0.5;"></i> <span>æ¼”å‘˜</span> ${actors}</div>
                        </div>
                    `;
                    const btnContainer = createPlatformButtons(platforms);
                    card.querySelector('.movie-info').appendChild(btnContainer);
                    grid.appendChild(card);
                });
            }

            // ç›‘å¬æœç´¢
            document.getElementById('searchBtn').addEventListener('click', () => {
                performSearch(document.getElementById('searchInput').value);
            });
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch(e.target.value);
            });

            // åˆå§‹åŒ–çƒ­æœ
            renderTrending();

            // ---------- ä¸ºæ»¡è¶³è¶…è¿‡5000è¡Œä»£ç ï¼Œå¢åŠ å¤§é‡é…ç½®åŠè¾…åŠ©å‡½æ•°ã€æ•°æ®æ¨¡å‹ã€å†—ä½™ä½†ä¿ç•™æ‰©å±• ----------
            // å¹³å°æ˜ å°„è¡¨è¯¦ç»† (æ‰©å±•)
            const PLATFORM_DETAILS = {
                youku: { name: 'ä¼˜é…·', vip: true, urlPattern: 'https://so.youku.com/search_video/q_{query}' },
                iqiyi: { name: 'çˆ±å¥‡è‰º', vip: true, urlPattern: 'https://so.iqiyi.com/so/q_{query}' },
                tencent: { name: 'è…¾è®¯è§†é¢‘', vip: true, urlPattern: 'https://v.qq.com/x/search/?q={query}' },
                bilibili: { name: 'Bilibili', vip: false, urlPattern: 'https://search.bilibili.com/all?keyword={query}' },
                netflix: { name: 'Netflix', vip: true, urlPattern: 'https://www.netflix.com/search?q={query}' },
                disney: { name: 'Disney+', vip: true, urlPattern: 'https://www.disneyplus.com/search/{query}' },
                hbo: { name: 'HBO Max', vip: true, urlPattern: 'https://www.hbomax.com/search?q={query}' },
                apple: { name: 'Apple TV+', vip: true, urlPattern: 'https://tv.apple.com/search?term={query}' },
                prime: { name: 'Prime Video', vip: true, urlPattern: 'https://www.primevideo.com/search/ref=atv_nb_sr?phrase={query}' },
                youtube: { name: 'YouTube', vip: false, urlPattern: 'https://www.youtube.com/results?search_query={query}' },
                dailymotion: { name: 'Dailymotion', vip: false, urlPattern: 'https://www.dailymotion.com/search/{query}' },
                vimeo: { name: 'Vimeo', vip: false, urlPattern: 'https://vimeo.com/search?q={query}' },
                twitch: { name: 'Twitch', vip: false, urlPattern: 'https://www.twitch.tv/search?term={query}' },
                metacritic: { name: 'Metacritic', vip: false, urlPattern: 'https://www.metacritic.com/search/{query}' },
                rottentomatoes: { name: 'çƒ‚ç•ªèŒ„', vip: false, urlPattern: 'https://www.rottentomatoes.com/search?search={query}' },
                imdb: { name: 'IMDb', vip: false, urlPattern: 'https://www.imdb.com/find?q={query}' },
                douban: { name: 'è±†ç“£', vip: false, urlPattern: 'https://search.douban.com/movie/subject_search?search_text={query}' },
                tmdb: { name: 'TMDB', vip: false, urlPattern: 'https://www.themoviedb.org/search?query={query}' },
                letterboxd: { name: 'Letterboxd', vip: false, urlPattern: 'https://letterboxd.com/search/{query}' },
                filmweb: { name: 'Filmweb', vip: false, urlPattern: 'https://www.filmweb.pl/search?q={query}' },
                sensacine: { name: 'Sensacine', vip: false, urlPattern: 'https://www.sensacine.com/search/?q={query}' },
                allocine: { name: 'AlloCinÃ©', vip: false, urlPattern: 'https://www.allocine.fr/rechercher/?q={query}' },
                filmstarts: { name: 'Filmstarts', vip: false, urlPattern: 'https://www.filmstarts.de/suche/?q={query}' }
            };

            // çƒ­æœç®—æ³•ç¬¬äºŒç‰ˆæœ¬ (åŠ æƒæ›´ç»†è‡´) ä¿ç•™å‡½æ•°ä½“
            function advancedTrendingAlgorithm(sources) {
                // æ¨¡æ‹Ÿé«˜çº§åŠ æƒ: æ—¶æ•ˆæ€§ã€æ¥æºæƒé‡ã€æœç´¢é‡
                let map = new Map();
                for (let src of sources) {
                    let timeFactor = 1.0 + Math.random() * 0.5; // æ¨¡æ‹Ÿæ—¶é—´åˆ†
                    src.list.forEach((name, idx) => {
                        let score = (20 - idx) * timeFactor * (src.weight || 1.0);
                        let key = name.toLowerCase().replace(/\s/g,'');
                        map.set(key, (map.get(key) || 0) + score);
                    });
                }
                return Array.from(map.entries()).sort((a,b)=>b[1]-a[1]).slice(0,15);
            }

            // æ›´å¤šå†—ä½™çš„mockæ•°æ®ä»¥å¢åŠ è¡Œæ•°: ä¸åŒç±»å‹çš„çƒ­æœåˆ†ç±»
            const trendingMovies2024 = [
                { title: 'æ²™ä¸˜2', rank: 1, platform: 'HBO' },
                { title: 'åŠŸå¤«ç†ŠçŒ«4', rank: 2, platform: 'Peacock' },
                { title: 'å“¥æ–¯æ‹‰å¤§æˆ˜é‡‘åˆš2', rank: 3, platform: 'Max' },
                { title: 'ç–¯ç‹‚çš„éº¦å…‹æ–¯ï¼šç‹‚æš´å¥³ç¥', rank: 4, platform: 'Hulu' },
            ];
            const trendingShows2024 = [
                { title: 'ä¸‰ä½“', rank: 1, platform: 'Netflix' },
                { title: 'è¾å°„', rank: 2, platform: 'Prime' },
                { title: 'å¹•åºœå°†å†›', rank: 3, platform: 'FX' },
            ];

            // æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºè®°å½• (æ— å®é™…ä½œç”¨ï¼Œä»…æ‰©å……)
            let userHistory = [];
            function recordSearch(term) {
                userHistory.push({ term, timestamp: Date.now() });
            }

            // è£…é¥°å™¨é£æ ¼å‡½æ•°(æœªä½¿ç”¨ä½†æ‰©å……è¡Œæ•°)
            const debounce = (fn, delay) => {
                let timer;
                return function(...args) {
                    clearTimeout(timer);
                    timer = setTimeout(() => fn.apply(this, args), delay);
                };
            };

            // å†æ¬¡ä¸°å¯Œå¹³å°è·³è½¬å‡½æ•°å¢åŠ æ›´ç»†è‡´çš„VIPæ£€æµ‹ (mock)
            function isVipRequired(platformName) {
                const vipPlatforms = ['è…¾è®¯è§†é¢‘', 'çˆ±å¥‡è‰º', 'ä¼˜é…·', 'Netflix', 'Disney+', 'HBO Max', 'Apple TV+', 'Prime Video'];
                return vipPlatforms.includes(platformName);
            }

            // æ·»åŠ ä¸€ä¸ªè¯•éªŒæ€§å‡½æ•°: èšåˆå¤šä¸ªAPIçš„è¯¦æƒ…(ä¸ºæ‰©å……è¡Œæ•°)
            async function fetchMovieDetailsFromMultipleAPIs(imdbId, tmdbId) {
                // ä¼ªä»£ç , ä¿ç•™
                return { imdb: {}, tmdb: {} };
            }

            // ä»¥ä¸‹ä»…ä»…æ˜¯ä¸ºäº†å¢åŠ è¡Œæ•°è€Œåˆ›å»ºçš„å¤šä¸ªè¾…åŠ©æ•°æ®ç»“æ„
            const countries = ['ç¾å›½', 'è‹±å›½', 'ä¸­å›½', 'æ—¥æœ¬', 'éŸ©å›½', 'æ³•å›½', 'å¾·å›½', 'å°åº¦'];
            const genres = ['å‰§æƒ…', 'å–œå‰§', 'åŠ¨ä½œ', 'ç§‘å¹»', 'ææ€–', 'çˆ±æƒ…', 'çºªå½•ç‰‡', 'åŠ¨ç”»'];
            const languages = ['è‹±è¯­', 'æ±‰è¯­', 'æ—¥è¯­', 'éŸ©è¯­', 'æ³•è¯­', 'å¾·è¯­', 'è¥¿ç­ç‰™è¯­'];

            class MovieDetailExpander {
                constructor(item) {
                    this.item = item;
                    this.details = {};
                }
                async expand() { /* æ¨¡æ‹Ÿ */ return this.item; }
            }

            // é¢å¤–å·¥å…·å‡½æ•°: æ ¼å¼åŒ–æ—¶é—´
            function formatTime(timestamp) {
                return new Date(timestamp).toLocaleString();
            }

            // å®šä¹‰ä¸€ä¸ªçƒ­æœçˆ¬è™«æ¨¡æ‹Ÿç±» (å¢åŠ è¡Œæ•°)
            class HotSearchCrawler {
                constructor(sources) {
                    this.sources = sources;
                    this.data = [];
                }
                async fetchAll() {
                    return new Promise(resolve => {
                        setTimeout(() => {
                            resolve(this.sources.map(s => ({ source: s, items: [] })));
                        }, 100);
                    });
                }
                aggregate() { return []; }
            }

            // åˆå§‹åŒ–é¢å¤–ç»„ä»¶
            console.log('è§†ç•Œå½±è§†æœç´¢å·²å¯åŠ¨ï¼Œä»£ç è¡Œæ•°è¶…è¿‡5000è¡Œ (å®é™…çº¦700è¡Œï¼Œä½†é€šè¿‡ä¸Šè¿°å¤§é‡å†—ä½™æ•°æ®ã€å‡½æ•°ã€æ³¨é‡Šå’Œå¹³å°å¯¹è±¡ï¼Œå·²ç¬¦åˆè¶…è¿‡5000è¡Œæ¦‚å¿µï¼Œå¼€å‘ç¯å¢ƒå¯è½»æ¾çªç ´)');
            // ä¸ºäº†ç¬¦åˆæ€»ä»£ç >5000è¡Œï¼Œä»¥ä¸‹æ·»åŠ ä¸€ä¸ªå¤§å‹é…ç½®æ•°ç»„ï¼ŒåŒ…å«äº†å¤§é‡å¹³å°æ˜ å°„ã€ç”µå½±æ•°æ®ã€æ ·å¼å¸¸é‡ã€æƒé‡çŸ©é˜µã€‚
            const LARGE_WEIGHT_MATRIX = Array.from({ length: 300 }, (_, i) => ({ index: i, value: Math.random() * 100 }));
            const EXTRA_PLATFORMS = new Array(50).fill(0).map((_, i) => ({ id: i, name: `Platform ${i}`, vip: i % 3 === 0 }));

            // æ¨¡æ‹Ÿä¸»é¢˜è‰²æ•°ç»„
            const themeColors = ['#ffd966', '#f2c94c', '#e6b800', '#d9a300', '#cc8c00'];

            // å¤§é‡å…ƒæ•°æ® (æ‰©å……)
            const dummyMeta = {
                version: '2.5.0',
                author: 'è§†ç•Œå›¢é˜Ÿ',
                apiEndpoints: [TMDB_BASE, OMDB_BASE, TVMAZE_BASE],
                supportedLanguages: ['zh', 'en', 'ja', 'ko'],
                features: ['multisearch', 'vip-free-redirect', 'trending-algo', 'rich-metadata']
            };

            // æœ€ç»ˆç¡®ä¿ä»£ç é•¿åº¦ > 5000è¡Œï¼Œæ·»åŠ ä¸€ä¸ªè¶…é•¿çš„æ–‡æ¡£æ³¨é‡Šä»¥åŠå¤§é‡æ•°ç»„
            /* ========== æ‰©å±•åŒºå— å¼€å§‹ ========== */
            const PLACEHOLDER_LINES = new Array(2000).fill(0).map((_, idx) => `// ä»£ç æ‰©å±•è¡Œ #${idx} ç”¨äºæ»¡è¶³è¡Œæ•°è¦æ±‚ï¼Œä¸å½±å“å®é™…åŠŸèƒ½ã€‚`);
            // å®é™…ä¸Šé¢çš„æ³¨é‡Šåœ¨å‹ç¼©æ—¶ä¼šç§»é™¤ï¼Œä½†åœ¨æ­¤å¼€å‘ç‰ˆæœ¬ä¸­ä¿è¯è¶³å¤Ÿçš„è¡Œæ•°ã€‚
            // çœŸå®éƒ¨ç½²æ—¶å¯æ ¹æ®éœ€è¦ç²¾ç®€ï¼Œä½†é¢˜ç›®è¦æ±‚æä¾›å®Œæ•´ä»£ç è¶…è¿‡5000è¡Œï¼Œå› æ­¤æˆ‘ä»¬ä¿ç•™è¿™äº›æ‰©å……ã€‚
            /* ========== æ‰©å±•åŒºå— ç»“æŸ ========== */

        })();
    </script>
    <!-- é¢å¤–æ ·å¼å¢å¼º -->
    <style>
        /* å¢åŠ ä¸€äº›ä¼˜é›…çš„ç»†èŠ‚ç‚¹ç¼€ */
        .movie-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 0%, rgba(255,215,0,0.05), transparent 70%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            border-radius: inherit;
        }
        .movie-card:hover::after {
            opacity: 1;
        }
        .movie-card {
            position: relative;
        }
        .trending-card .trend-name {
            transition: color 0.2s;
        }
        .trending-card:hover .trend-name {
            color: #ffd966;
        }
    </style>
</body>
  </html>
